<!DOCTYPE html>
<html>
<head>
    <title>three.js webgl</title>
    <meta charset="utf-8">
    <link rel="stylesheet" href="../frameworks/highlight/styles/googlecode.min.css">
    <link rel="stylesheet" href="../samples/css/code.css">
    <script src="../frameworks/highlight/highlight.pack.js"></script>
    <script src="../frameworks/highlight/highlightjs-line-numbers.min.js"></script>
    <script src="../samples/js/code.js"></script>
    <script>
        hljs.initHighlightingOnLoad();
        hljs.initLineNumbersOnLoad();
    </script>
</head>
<body>

<!-- code -->
<div id="wrapper">
<h2>07-ground.html</h2>
<pre><code class="html">
&lt;!DOCTYPE html&gt;
&lt;html xmlns=&quot;http://www.w3.org/1999/xhtml&quot;&gt;
&lt;head&gt;
    &lt;title&gt;The Five Planets&lt;/title&gt;
    &lt;meta http-equiv=&quot;content-type&quot; content=&quot;text/html;charset=utf-8&quot; /&gt;
    &lt;style&gt;
        body {
            width:100%;
            height:100%;
            padding:0;
            margin:0;
            overflow:hidden;
        }
    &lt;/style&gt;
    &lt;link rel=&quot;stylesheet&quot; type=&quot;text/css&quot; href=&quot;../css/screen.css&quot;/&gt;
    
    &lt;!-- LOAD JQUERY &amp; REQUIERE --&gt;
    &lt;script src=&quot;../frameworks/require.min.js&quot;&gt;&lt;/script&gt;
    &lt;script src=&quot;../frameworks/jquery-2.0.3.min.js&quot;&gt;&lt;/script&gt;
    
    &lt;!-- LOAD THREE.JS --&gt;
    &lt;script src=&quot;../frameworks/three.min.js&quot; defer&gt;&lt;/script&gt;
    &lt;script src=&quot;../frameworks/renders/projector.js&quot; defer&gt;&lt;/script&gt;
    &lt;script src=&quot;../frameworks/loaders/DDSLoader.js&quot; defer&gt;&lt;/script&gt;
    &lt;script src=&quot;../frameworks/loaders/MTLLoader.js&quot; defer&gt;&lt;/script&gt;
    &lt;script src=&quot;../frameworks/loaders/OBJLoader.js&quot; defer&gt;&lt;/script&gt;
    &lt;script src=&quot;../frameworks/loaders/ColladaLoader.js&quot; defer&gt;&lt;/script&gt;
    &lt;script src=&quot;../frameworks/loaders/collada/Animation.js&quot; defer&gt;&lt;/script&gt;
    &lt;script src=&quot;../frameworks/loaders/collada/AnimationHandler.js&quot; defer&gt;&lt;/script&gt;
    &lt;script src=&quot;../frameworks/loaders/collada/KeyFrameAnimation.js&quot; defer&gt;&lt;/script&gt;
    
    &lt;!-- LOAD DAT.GUI &amp; STATS--&gt;
    &lt;script src=&quot;../frameworks/dat.gui.min.js&quot; defer&gt;&lt;/script&gt;
    &lt;script src=&quot;../frameworks/stats.js&quot; defer&gt;&lt;/script&gt;
    
    &lt;!-- GAME FILES--&gt;
    &lt;script src=&quot;../core/controls/controls_path_v01.js&quot; defer&gt;&lt;/script&gt;
    &lt;script src=&quot;../core/world/world_v01.js&quot; defer&gt;&lt;/script&gt;
    &lt;script src=&quot;../core/world/ground_v01.js&quot; defer&gt;&lt;/script&gt;
    
&lt;script&gt;
$(document).ready(function () {
    $WORLD.init3D({}, function () {
        $WORLD.map = {
        &quot;x&quot;:256,
        &quot;z&quot;:256,
        &quot;ground&quot;: {
            &quot;type&quot;:&quot;basic&quot;,
            &quot;texture&quot;:&quot;../data/graphics/textures/terrain/grass1.jpg&quot;,
            &quot;resX&quot;:2,
            &quot;resY&quot;:2
        }};
        $WORLD.drawGround();
        var path=new THREE.CatmullRomCurve3([
            new THREE.Vector3(5, 2, 50),
            new THREE.Vector3(9, 2, 40),
            new THREE.Vector3(15, 2, 55),
            new THREE.Vector3(50, 2, 5),
            new THREE.Vector3(30, 2, 5),
            new THREE.Vector3(35, 2, 50),
            new THREE.Vector3(43, 2, 27),
            new THREE.Vector3(50, 2, 33),
            new THREE.Vector3(5, 2, 50)])
        $WORLD.controls = new $CONTROLS.PathControls ($WORLD.camera, path, {&quot;velocity&quot;:2});
        $WORLD.controls.showPath();
        $WORLD.addToListUpdate ($WORLD.controls)
        $WORLD.showStats();
        $WORLD.startAnimation();
    });
})
&lt;/script&gt;
    &lt;link rel=&quot;stylesheet&quot; href=&quot;../samples/css/sample.css&quot;&gt;
    &lt;script src=&quot;../samples/js/sample.js&quot;&gt;&lt;/script&gt;
&lt;/head&gt;
&lt;body&gt;


&lt;!-- butons --&gt;
&lt;div id=&quot;sample-info&quot;&gt;
&lt;/div&gt;
&lt;div id=&quot;sample-buttons&quot; class=&quot;sample-btn&quot;&gt;
&lt;/div&gt;

&lt;!-- Adsense &amp; google analytics--&gt;
&lt;div id=&quot;adsense&quot; style=&quot;position:absolute;background:#ff5063;width:468px;height:60px;z-index:9999;left:50%;margin-left:-234px;top:0px;&quot;&gt;
&lt;script async src=&quot;//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js&quot;&gt;&lt;/script&gt;
&lt;ins class=&quot;adsbygoogle&quot; style=&quot;display:inline-block;width:468px;height:60px&quot; data-ad-client=&quot;ca-pub-7096241178360063&quot; data-ad-slot=&quot;1466241659&quot;&gt;&lt;/ins&gt;
&lt;script&gt;(adsbygoogle = window.adsbygoogle || []).push({});&lt;/script&gt;
&lt;/div&gt;
&lt;div id=&quot;close-adsense&quot; style=&quot;position:absolute;background:url(&#39;../data/graphics/close-ad.png&#39;);width:15px;height:60px;z-index:9999;left:50%;margin-left:234px;cursor:pointer;top:0px&quot; onclick=&quot;document.getElementById(&#39;adsense&#39;).style.display=&#39;none&#39;;document.getElementById(&#39;close-adsense&#39;).style.display=&#39;none&#39;;&quot;&gt;
&lt;/div&gt;
&lt;script&gt;
  (function(i,s,o,g,r,a,m){i[&#39;GoogleAnalyticsObject&#39;]=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,&#39;script&#39;,&#39;https://www.google-analytics.com/analytics.js&#39;,&#39;ga&#39;);

  ga(&#39;create&#39;, &#39;UA-85095147-1&#39;, &#39;auto&#39;);
  ga(&#39;send&#39;, &#39;pageview&#39;);
&lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</code></pre>


<h2>core/world/ground_v01.js</h2>
<pre><code class="javascript">
//****************************
// CREA EL SUELO DEL MUNDO
//****************************

$WORLD.drawGround = function () {
    var map = $WORLD.map;
    var groundTexture = $WORLD.textureLoader.load(map.ground.texture);
    var x = $WORLD.distance * 2.25 + map.x
    var z = $WORLD.distance * 2.25 + map.z
    groundTexture.wrapS = groundTexture.wrapT = THREE.RepeatWrapping;
    groundTexture.repeat.set(x / 2, z / 2); 
    groundTexture.anisotropy = 16;
    var groundMaterial = new THREE.MeshLambertMaterial({ color: 0xffffff, map: groundTexture });
    var mesh = new THREE.Mesh(new THREE.PlaneBufferGeometry(x, z), groundMaterial);
    mesh.position.y = 0;
    mesh.position.x = map.x / 2;
    mesh.position.z = map.z / 2;
    mesh.rotation.x = - Math.PI / 2;
    mesh.receiveShadow = true;
    $WORLD.scene.add(mesh);
}

</code></pre>

<h2>core/world/world_v01.js</h2>
<pre><code class="javascript">
//*******************************
//DEFINIR EL MUNDO
//*******************************
var $WORLD = $WORLD || {};
$WORLD.distance = 80;
$WORLD.renderer = null;
$WORLD.scene = null;
$WORLD.clock = null;
$WORLD.map=null;
$WORLD.controls=null;
$WORLD._objUpdate = [];

$WORLD.init3D=function(oPars, fSuc, fFail) {

    var renderer = new THREE.WebGLRenderer();
    renderer.shadowMap.enabled = true;
    renderer.shadowMap.type = THREE.PCFSoftShadowMap;
    renderer.setSize(window.innerWidth, window.innerHeight);
    document.body.appendChild(renderer.domElement);
    $WORLD.renderer = renderer;
    $WORLD.scene = new THREE.Scene();
    
    $WORLD.camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, $WORLD.distance);
    $WORLD.camera.position.set(0, 2, 0);
    $WORLD.camera.lookAt(new THREE.Vector3(0,2,0) );
    
    $WORLD.clock = new THREE.Clock();
    $WORLD.controls={
        getPosition: function(){
            return $WORLD.camera.position;
        }
    } 

    $WORLD.textureLoader = new THREE.TextureLoader();
    
    $WORLD.ambientLight = new THREE.AmbientLight(0xffffff,1);
    $WORLD.scene.add($WORLD.ambientLight);
 
    $WORLD.scene.fog = new THREE.Fog(0xffffff, 5, ($WORLD.distance - $WORLD.distance / 4)); //niebla
    $WORLD.renderer.setClearColor($WORLD.scene.fog.color, 1);
    
    window.addEventListener(&#39;resize&#39;, onWindowResize, false);
    THREE.Loader.Handlers.add(/\.dds$/i, new THREE.DDSLoader());
    fSuc();
}

$WORLD.showStats=function() {
    if (!($WORLD.stats)) {
        $WORLD.stats = new Stats();
        $WORLD.stats.setMode(0);
        document.body.appendChild($WORLD.stats.domElement);
        $WORLD.addToListUpdate($WORLD.stats);
    };

}

$WORLD.startAnimation = function () {
    $WORLD.animate();
}

$WORLD.pauseAnimation = function () {
    window.cancelAnimationFrame( $WORLD.idAnim );
}

$WORLD.addToListUpdate = function (obj) {
    $WORLD._objUpdate.push(obj);
}

$WORLD.animate = function () {
    $WORLD.idAnim = requestAnimationFrame($WORLD.animate);
    var delta = $WORLD.clock.getDelta();
    for (var i = 0; i &lt; $WORLD._objUpdate.length; i++) {
        $WORLD._objUpdate[i].update(delta);
    };
    THREE.AnimationHandler.update(delta);
    $WORLD.renderer.render($WORLD.scene, $WORLD.camera);

};

function onWindowResize() {
    $WORLD.camera.aspect = window.innerWidth / window.innerHeight;
    $WORLD.camera.updateProjectionMatrix();
    $WORLD.renderer.setSize(window.innerWidth, window.innerHeight);
}

</code></pre>

<h2>core/controls/controls_path_v01.js</h2>
<pre><code class="javascript">
var $CONTROLS = $CONTROLS || {};

$CONTROLS.PathControls = function (object, path, prop) {
    this.path=path;
    this._object=object;
    this._pos=0;
    this.velocity=1; //unidades por segundo
    if (prop &amp;&amp; prop.velocity){
        this.velocity=prop.velocity;
    }
    this._factor=this.velocity/this.path.getLength();
};

$CONTROLS.PathControls.prototype.update = function ( delta ) {
    this._object.position.copy(this.path.getPointAt(this._pos));
    this._pos += (this._factor  * delta);
    if (this._pos &gt; 1) {this._pos = 0;};
    this._object.lookAt(this.path.getPointAt(this._pos));
}

$CONTROLS.PathControls.prototype.showPath = function ( ) {
    var geometry = new THREE.Geometry();
    var points = this.path.getPoints(50);

    var material = new THREE.LineBasicMaterial({
        color: 0xff00f0
    });

    geometry.vertices = points;
    var line = new THREE.Line(geometry, material);
    line.position.set(0,0.25,0)
    $WORLD.scene.add(line);
}

$CONTROLS.PathControls.prototype.getPosition = function ( ) {
    return this._object.position;
}

</code></pre>
</div>
</body>
</html>
